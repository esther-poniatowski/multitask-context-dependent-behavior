#!/usr/bin/env bash

# =================================================================================================
# Script Name: deploy_to_hub.sh
# Description: Deploy the directory structure and files on a remote hub.
#
# Variables
# ---------
# CREDENTIALS_HUB
#   Path to the .env file containing the credentials for the remote hub.
# MAP_DEPLOY
#   Path to the .yml file containing the sync map for the deployment process.
# TRANSFER_SCRIPT
#   Path to the python script for transferring files and directories across the network.
# =================================================================================================



# Ensure required files exists
if [ ! -f "$CREDENTIALS_HUB" ]; then
  echo "Error: The .env file with credentials not found at $CREDENTIALS_HUB"
  exit 1
fi

if [ ! -f "$MAP_DEPLOY" ]; then
  echo "Error: The sync map file not found at $MAP_DEPLOY"
  exit 1
fi

if [ ! -f "$TRANSFER_SCRIPT" ]; then
  echo "Error: The transfer script not found at $TRANSFER_SCRIPT"
  exit 1
fi

# Execute the transfer script
python "$TRANSFER_SCRIPT" --env-path "$CREDENTIALS_HUB" --sync-map-path "$MAP_DEPLOY" --direction upload

# Check transfer success
if [ $? -eq 0 ]; then
  echo "[SUCCESS] Deployment to the remote hub."
else
  echo "[ERROR]: Deployment failed."
  exit 1
fi
